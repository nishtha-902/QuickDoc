<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('partial/title.ejs'); %>

  <link rel="stylesheet" href="assets/lib/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/lib/css/fontawesome.min.css">
  <link rel="stylesheet" href="assets/css/header.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #f4f7fb;
      font-family: 'Segoe UI', sans-serif;
    }

    .dashboard-wrapper {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar - lighter theme */
    .sidebar {
      width: 250px;
      background: #ffffff;
      border-right: 1px solid #dee2e6;
      color: #2a5298;
      padding-top: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .sidebar h4 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
      color: #007bff;
    }

    .sidebar a {
      display: block;
      padding: 12px 20px;
      color: #007bff;
      text-decoration: none;
      border-radius: 8px;
      margin: 5px 10px;
      transition: 0.3s;
    }

    .sidebar a:hover {
      background-color: rgba(0, 123, 255, 0.1);
      color: #0056b3;
    }

    /* Main Content */
    .main-content {
      flex-grow: 1;
      padding: 30px;
    }

    .card {
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
      margin-bottom: 25px;
    }

    .card h5 {
      color: #007bff;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .appointment-card {
      border-left: 4px solid #007bff;
      padding: 15px;
      margin-bottom: 15px;
      background: #fff;
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .appointment-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .appointment-card b {
      color: #333;
    }

    .btn-confirm {
      background: #28a745;
      color: #fff;
      border-radius: 20px;
      padding: 6px 14px;
      border: none;
      margin-right: 5px;
    }

    .btn-danger {
      border-radius: 20px;
      padding: 6px 14px;
    }

    @media(max-width:768px) {
      .dashboard-wrapper {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        margin-bottom: 15px;
      }
    }
  </style>
</head>

<body>

  <%- include('partial/header.ejs', { data: data }); %>

  <div class="dashboard-wrapper">

    <!-- Sidebar -->
    <div class="sidebar">
      <h4>Doctor Panel</h4>
      <a href="#current">Current Appointments</a>
      <a href="#past">Past Appointments</a>
      <a href="/doctorhome/<%= data.user._id %>/edit">Update Profile</a>
      <a href="/logout"><i class="fa fa-sign-out"></i> Logout</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">

      <h2 class="mb-4">Welcome Dr. <%= data.user.name %></h2>

      <!-- Stats -->
      <div class="row">
        <div class="col-md-4">
          <div class="card p-3 text-center">
            <h5>Total Appointments</h5>
            <p class="fs-4"><%= data.futureappointment.length + data.pastappointment.length %></p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 text-center">
            <h5>Upcoming</h5>
            <p class="fs-4"><%= data.futureappointment.length %></p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card p-3 text-center">
            <h5>Past</h5>
            <p class="fs-4"><%= data.pastappointment.length %></p>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="card p-4">
        <h5>Appointments Overview</h5>
        <canvas id="doctorChart" height="100"></canvas>
      </div>

      <!-- Current Appointments -->
      <div class="card p-4" id="current">
        <h5>Current Appointments</h5>
        <% if (data.futureappointment && data.futureappointment.length > 0) { %>
          <% data.futureappointment.forEach(function(item){ %>
            <div class="appointment-card">
              <b>Patient:</b> <%= item.PatientName %><br>
              <b>Phone:</b> <%= item.PatientPhone %><br>
              <b>Date:</b> <%= item.AppointmentDate %><br>
              <b>Time:</b> <%= item.AppointmentTime %><br><br>

              <% if(item.Status === 'Yet to be confirmed'){ %>
                <a href="/doctorhome/<%= item.AppointmentId %>/accept" class="btn btn-confirm btn-sm">Accept</a>
                <a href="/doctorhome/<%= item.AppointmentId %>/reject" class="btn btn-danger btn-sm">Reject</a>
              <% } else { %>
                <span class="badge bg-secondary"><%= item.Status %></span>
              <% } %>
            </div>
          <% }); %>
        <% } else { %>
          <p>No upcoming appointments.</p>
        <% } %>
      </div>

      <!-- Past Appointments -->
      <div class="card p-4" id="past">
        <h5>Past Appointments</h5>
        <% if (data.pastappointment && data.pastappointment.length > 0) { %>
          <% data.pastappointment.forEach(function(item){ %>
            <div class="appointment-card">
              <b>Patient:</b> <%= item.PatientName %><br>
              <b>Date:</b> <%= item.AppointmentDate %><br>
              <b>Status:</b> <%= item.Status %><br><br>

              <% if(item.PrescriptionId){ %>
                <b>Prescription Added</b>
              <% } else { %>
                <a href="/doctorhome/<%= item.PatientId %>/<%= item.AppointmentId %>/addprescription"
                  class="btn btn-primary btn-sm">Add Prescription</a>
              <% } %>
            </div>
          <% }); %>
        <% } else { %>
          <p>No past appointments.</p>
        <% } %>
      </div>

    </div>
  </div>

  <%- include('partial/footer.ejs'); %>

  <script>
    const ctx = document.getElementById('doctorChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Upcoming', 'Past'],
        datasets: [{
          label: 'Appointments',
          data: ["<%= data.futureappointment.length %>", "<%= data.pastappointment.length %>"],
          backgroundColor: ['#007bff', '#17a2b8'],
          borderRadius: 6,
          barPercentage: 0.5,
          categoryPercentage: 0.5
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1 }
          }
        }
      }
    });
  </script>

</body>
</html>
